var importedLibrary,isExecuting=!1;const runButton=document.querySelector("button.button.primary-button.run-button"),stopButton=document.querySelector("button.button.primary-button.stop-button"),clearButton=document.querySelector("button.button.clear-button"),fileInput=document.querySelector('input[type="file"]'),consoleDiv=document.getElementById("console"),fileInputButton=document.querySelector("button#fileInput"),saveButton=document.querySelector("button#Save"),toggleButton=document.querySelector('input[type="checkbox"]');let fileHandle,_ESM=!1,_TS=!1,formatCode=!1;const options={types:[{description:"JavaScript",accept:{"application/javascript":[".js"]}}]};var editor=monaco.editor.create(document.getElementById("editor"),{value:["// Write your JavaScript code here!"].join("\n"),language:"javascript",minimap:{enabled:!1},acceptSuggestionOnEnter:"smart",autoClosingBrackets:"always",autoClosingComments:"always",autoIndent:"advanced",quickSuggestions:!0,formatOnType:!0,formatOnPaste:!0,automaticLayout:!0,parameterHints:{enabled:!0},highlightActiveBracketPair:!0,lineNumbersMinChars:2,fontFamily:"JetBrains Mono",stickyScroll:{enabled:!1},fontLigatures:!0});let Executor=new Worker("/src/Executor.min.js");function ESM(e){return e&&TS(!1),_ESM=e,_ESM}function TS(e){return e&&ESM(!1),_TS=e,function(t=(e?"typescript":"javascript")){var n=editor.getModel();monaco.editor.setModelLanguage(n,t)}(),_TS}function executeCode(){if(void 0!==importedLibrary)var e=importedLibrary+"\n"+editor.getValue()+"\n";else e=editor.getValue()+"\n";clearConsole(),isExecuting=!0,runButton.disabled=!0,stopButton.disabled=!1,Executor.onmessage=function(e){const{type:t,message:n,typeOf:o,executionStatus:a,executionTime:i}=e.data;logToConsole(n,t),"clear"===t&&clearConsole(),"executionStarted"===a&&(isExecuting=!0,runButton.disabled=!0,stopButton.disabled=!1),"executionEnded"===a&&(isExecuting=!1,runButton.disabled=!1,stopButton.disabled=!0,console.log(`Execution Time: ${i}ms`))},Executor.postMessage({code:e,ESM:_ESM,TS:_TS,formatCode:formatCode,maxEnvLnLen:function(e){const t=e.clientWidth-32;return Math.round(t/7.739130434782608)}(document.getElementById("console"))}),Executor.onerror=function(e){logToConsole("Worker Error: "+e.message,"error"),isExecuting=!1,runButton.disabled=!1,stopButton.disabled=!0}}function stopExecution(){Executor&&(isExecuting=!1,Executor.terminate(),Executor=new Worker("/src/Executor.min.js"),runButton.disabled=!1,stopButton.disabled=!0,logToConsole("Code execution stopped by the user","error"))}function logToConsole(e,t){const n=document.getElementById("console"),o=document.createElement("div"),a=document.createElement("pre");function i(){navigator.clipboard.writeText(e).then((function(){alert("Copied to clipboard")}),(function(e){alert("Failed to copy: "+e,"error")}))}o.classList.add("console-message",t),a.innerHTML=e,o.addEventListener("long-press",i),o.addEventListener("dblclick",i),o.appendChild(a),n.appendChild(o),n.scrollTop=n.scrollHeight}function clearConsole(){consoleDiv.innerHTML=""}function displayConsole(e){var t=document.getElementsByClassName("playground")[0],n=document.getElementsByClassName("playground-console")[0],o=document.getElementsByClassName("download-button")[0],a=document.getElementsByClassName("clear-button")[0],i=window.getComputedStyle(n).display;e?(i=n.style.display="block",a.style.display="block",t.style.width="calc(50vw - 22.5px)",o.style.left="calc(50vw - 65px)",fileInputButton.style.left="calc(50vw - 118px)",localStorage.setItem("consoleState","block")):"none"===i?(n.style.display="block",a.style.display="block",t.style.width="calc(50vw - 22.5px)",o.style.left="calc(50vw - 65px)",fileInputButton.style.left="calc(50vw - 118px)",localStorage.setItem("consoleState","block")):(n.style.display="none",a.style.display="none",t.style.width="calc(100vw - 30px)",o.style.left="calc(100vw - 121px)",fileInputButton.style.left="calc(100vw - 174px)",localStorage.setItem("consoleState","none"))}function fileToPlainText(e){return new Promise(((t,n)=>{const o=new FileReader;o.onloadend=()=>{const e=o.result;t(e)},o.onerror=n,o.readAsText(e)}))}function loadCode(){var e=localStorage.getItem("code");null!==e&&""!==e?editor.setValue(e):editor.setValue("// Write your JavaScript code here!\n")}editor.addAction({id:"runCode",label:"Run Code",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(){executeCode()}}),editor.addAction({id:"save",label:"Save",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S],contextMenuGroupId:"3_snippet",contextMenuOrder:2,run:async function(){if(fileHandle){const e=await fileHandle.createWritable();await e.write(editor.getValue()),await e.close()}else saveCodeToNewFile();checkFileHandleAndUpdateLocalStorage()}}),editor.addAction({id:"saveAs",label:"Save As",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.KEY_S],contextMenuGroupId:"3_snippet",contextMenuOrder:2.5,run:function(){saveCodeToNewFile()}}),runButton.addEventListener("click",executeCode),stopButton.disabled=!0,stopButton.addEventListener("click",stopExecution),function(e,t){"use strict";var n=null,o="PointerEvent"in e||e.navigator&&"msPointerEnabled"in e.navigator,a="ontouchstart"in e||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,i=o?"pointerdown":a?"touchstart":"mousedown",l=o?"pointerup":a?"touchend":"mouseup",c=o?"pointermove":a?"touchmove":"mousemove",r=o?"pointerleave":a?"touchleave":"mouseleave",d=0,s=0;function u(e){p(),e=function(e){return void 0!==e.changedTouches?e.changedTouches[0]:e}(e),this.dispatchEvent(new CustomEvent("long-press",{bubbles:!0,cancelable:!0,detail:{clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY},clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY}))||t.addEventListener("click",(function e(n){t.removeEventListener("click",e,!0),function(e){e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation()}(n)}),!0)}function m(o){p(o);var a=o.target,i=parseInt(function(e){for(;e&&e!==t.documentElement;){var n=e.getAttribute("data-long-press-delay");if(n)return n;e=e.parentNode}return"500"}(a),10);n=function(t,n){if(!(e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame&&e.mozCancelRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame))return e.setTimeout(t,n);var o=(new Date).getTime(),a={},i=function(){(new Date).getTime()-o>=n?t.call():a.value=requestAnimFrame(i)};return a.value=requestAnimFrame(i),a}(u.bind(a,o),i)}function p(t){var o;(o=n)&&(e.cancelAnimationFrame?e.cancelAnimationFrame(o.value):e.webkitCancelAnimationFrame?e.webkitCancelAnimationFrame(o.value):e.webkitCancelRequestAnimationFrame?e.webkitCancelRequestAnimationFrame(o.value):e.mozCancelRequestAnimationFrame?e.mozCancelRequestAnimationFrame(o.value):e.oCancelRequestAnimationFrame?e.oCancelRequestAnimationFrame(o.value):e.msCancelRequestAnimationFrame?e.msCancelRequestAnimationFrame(o.value):clearTimeout(o)),n=null}"function"!=typeof e.CustomEvent&&(e.CustomEvent=function(e,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var o=t.createEvent("CustomEvent");return o.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),o},e.CustomEvent.prototype=e.Event.prototype),e.requestAnimFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)},t.addEventListener(l,p,!0),t.addEventListener(r,p,!0),t.addEventListener(c,(function(e){var t=Math.abs(d-e.clientX),n=Math.abs(s-e.clientY);(t>=10||n>=10)&&p()}),!0),t.addEventListener("wheel",p,!0),t.addEventListener("scroll",p,!0),t.addEventListener("contextmenu",p,!0),t.addEventListener(i,(function(e){d=e.clientX,s=e.clientY,m(e)}),!0)}(window,document),window.onload=function(){var e=localStorage.getItem("consoleState");if(e){var t=document.getElementsByClassName("playground")[0],n=document.getElementsByClassName("playground-console")[0],o=document.getElementsByClassName("clear-button")[0],a=document.getElementsByClassName("download-button")[0];n.style.display=e,o.style.display=e,t.style.width="none"===e?"calc(100vw - 30px)":"calc(50vw - 22.5px)",a.style.left="none"===e?"calc(100vw - 121px)":"calc(50vw - 65px)",fileInputButton.style.left="none"===e?"calc(100vw - 174px)":"calc(50vw - 118px)"}},fileInput.addEventListener("change",(e=>{fileToPlainText(e.target.files[0]).then((e=>{importedLibrary=e,logToConsole("File Imported Successfully","msg")}))})),document.addEventListener("keydown",(function(e){e.ctrlKey&&"Enter"===e.key&&executeCode()})),document.addEventListener("keydown",(function(e){e.ctrlKey&&"Escape"===e.key&&stopExecution()})),window.editor.getModel().onDidChangeContent((()=>{fileHandle?checkFileHandleAndUpdateLocalStorage():localStorage.setItem("code",editor.getValue())})),document.addEventListener("DOMContentLoaded",loadCode);const fileName="Script.js",mimeType="application/javascript",charset="utf-8";function createHiddenLink(e){const t=document.createElement("a");return t.style.display="none",t.href=`data:${mimeType};charset=utf-8,${encodeURIComponent(e)}`,t.download=fileName,t}function triggerDownload(e){document.body.appendChild(e),e.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),e.remove()}function saveCodeToNewFile(){const e=createHiddenLink(editor.getValue());setTimeout((()=>triggerDownload(e)),10)}function checkFileHandleAndUpdateLocalStorage(){fileHandle&&localStorage.setItem("code","// Write your JavaScript code here!\n")}function darkMode(e){"dark"===e&&((e=>{const t=document.createElement("link");t.id="dark-mode",t.type="text/css",t.rel="stylesheet",t.href=e,document.head.appendChild(t)})("/src/darkMode.css"),monaco.editor.setTheme("vs-dark"),localStorage.setItem("theme","dark")),"light"===e&&((()=>{const e=document.getElementById("dark-mode");e&&e.remove()})(),monaco.editor.setTheme("vs"),localStorage.setItem("theme","light"))}function loadTheme(){"light"===localStorage.getItem("theme")?(darkMode("light"),toggleButton.checked=!1):(darkMode("dark"),toggleButton.checked=!0)}fileInputButton.onclick=async()=>{[fileHandle]=await window.showOpenFilePicker(options);const e=await fileHandle.getFile(),t=await e.text();return editor.setValue(t),checkFileHandleAndUpdateLocalStorage(),t},saveButton.onclick=async()=>{if(fileHandle){const e=await fileHandle.createWritable();await e.write(editor.getValue()),await e.close()}else saveCodeToNewFile();checkFileHandleAndUpdateLocalStorage()},document.addEventListener("keydown",(async function(e){if(e.ctrlKey&&"s"===e.key){if(e.preventDefault(),e.stopPropagation(),fileHandle){const e=await fileHandle.createWritable();await e.write(editor.getValue()),await e.close()}else saveCodeToNewFile();checkFileHandleAndUpdateLocalStorage()}}),{capture:!1,passive:!1}),toggleButton.addEventListener("change",(function(){toggleButton.checked?darkMode("dark"):darkMode("light")})),document.addEventListener("DOMContentLoaded",loadTheme);